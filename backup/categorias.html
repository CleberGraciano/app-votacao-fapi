<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CRUD Categorias - Frontend</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="p-3">

  <h2>Cadastro de Categorias</h2>

  <form id="categoriaForm" class="mb-3">
    <input type="hidden" id="categoriaId" />
    <div class="mb-3">
      <label for="categoriaNome" class="form-label">Nome da Categoria</label>
      <input type="text" id="categoriaNome" class="form-control" placeholder="Digite o nome" required />
    </div>
    <button type="submit" class="btn btn-primary">Salvar</button>
    <button type="button" id="btnCancelar" class="btn btn-secondary">Cancelar</button>
  </form>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="tabelaCategorias"></tbody>
  </table>

  <script>
    const apiUrlCategoria = 'http://localhost:8080/api/categorias';

    const form = document.getElementById('categoriaForm');
    const inputId = document.getElementById('categoriaId');
    const inputNome = document.getElementById('categoriaNome');
    const tabela = document.getElementById('tabelaCategorias');
    const btnCancelar = document.getElementById('btnCancelar');

    // Carregar categorias da API
    function carregarCategorias() {
      fetch(apiUrlCategoria)
        .then(res => res.json())
        .then(data => {
          tabela.innerHTML = '';
          data.forEach(cat => {
            tabela.innerHTML += `
              <tr>
                <td>${cat.id}</td>
                <td>${cat.nome}</td>
                <td>
                  <button class="btn btn-sm btn-warning" onclick="editarCategoria(${cat.id})">Editar</button>
                  <button class="btn btn-sm btn-danger" onclick="excluirCategoria(${cat.id})">Excluir</button>
                </td>
              </tr>
            `;
          });
        })
        .catch(err => alert('Erro ao carregar categorias: ' + err));
    }

    // Salvar categoria (create ou update)
    form.addEventListener('submit', e => {
      e.preventDefault();

      const id = inputId.value;
      const nome = inputNome.value.trim();

      if (!nome) {
        alert('Nome é obrigatório');
        return;
      }

      const method = id ? 'PUT' : 'POST';
      const url = id ? `${apiUrlCategoria}/${id}` : apiUrlCategoria;

      fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome })
      })
        .then(res => {
          if (!res.ok) throw new Error('Erro na resposta da API');
          return res.json();
        })
        .then(() => {
          carregarCategorias();
          form.reset();
          inputId.value = '';
        })
        .catch(err => alert('Erro ao salvar categoria: ' + err));
    });

    // Editar categoria (buscar dados e preencher o formulário)
    function editarCategoria(id) {
      fetch(`${apiUrlCategoria}/${id}`)
        .then(res => {
          if (!res.ok) throw new Error('Categoria não encontrada');
          return res.json();
        })
        .then(cat => {
          inputId.value = cat.id;
          inputNome.value = cat.nome;
        })
        .catch(err => alert(err));
    }

    // Excluir categoria
    function excluirCategoria(id) {
      if (!confirm('Confirma exclusão da categoria?')) return;

      fetch(`${apiUrlCategoria}/${id}`, { method: 'DELETE' })
        .then(res => {
          if (!res.ok) throw new Error('Erro ao excluir');
          carregarCategorias();
        })
        .catch(err => alert(err));
    }

    // Cancelar edição
    btnCancelar.addEventListener('click', () => {
      form.reset();
      inputId.value = '';
    });

    // Inicializa a lista
    carregarCategorias();
  </script>

</body>
</html>
